# Лабораторные

## Лаба 1

Создайте новый solution в visual studio, тип Console Application. Создайте на GitLab новый репозиторий и подключите свой solution к этому репозиторию.

Нужно разработать программу по ведению библиотеки. В библиотеке есть книги за чьим-то авторством, названием и годом издания. Также у книги известно, в шкафу с каким номером и на какой полке она стоит. Книги могут брать читатели, о которым известно их ФИО и уникальный номер читательского билета. Известно кто какую книгу когда взял и когда вернул.

Разработайте схему базы данных, заполните примером данных. Схема хранится в отдельных файлах в формате json, данные в других файлах в формате csv.

Затем спроектируйте классы, которые позволили бы отражали структуру БД. Создайте объекты этих классов, проинициализировав их тестовыми данными.

## Лаба 2

Заполнять тестовые данные в коде, т.е. создавать объекты с предзаданными значения - нежизнеспособно. Данные уже есть в текстовых файлах, оттуда их нужно извлечь.

Во-первых, при старте программы добавьте проверку, что данные в csv файлах не содержат ошибок и соответствуют схеме БД, описанной в json файлах. Кол-во столбцов должно совпадать, тип данных в каждом столбце не должны соответствовать типу столбца - это значит, что если в схеме БД, указано, что столбец имеет тип int, то в файле с данными не может быть в этом столбце записана строка.

Если проверка неуспешна, тюкю файлы с данными содержат ошибки, выведите соответствующее сообщение: что не совпало, какой столбец не совпал по данным и т.д.

Если проверка успешна, то считайте данные из файлов в объекты классов. Для провереки, что данные считаны корректно, выведите на экран список всех книг. Если книга у кого-то на руках, то напишите его имя и когда книгу взяли.

## Лаба 3

Теперь сделайте красивое форматирование вывода на экран информации. Плохой пример оформления вывода:
```
Автор | Название | Читает | Взял
|----|------|----
Толстой | Война и мир | Иван И. | 01.08.2022
Достоевский | Преступление и наказание |  |
```
Такую таблицу тяжело анализировать человеку. Поэтому ее нужно форматировать, например, вот так:
```
| Автор       | Название                 | Читает  | Взял       |
| ----------- | ------------------------ | ------- | ---------- |
| Толстой     | Война и мир              | Иван И. | 01.08.2022 |
| Достоевский | Преступление и наказание |         |            |
```
Обратите внимание, что ширина столбца подгоняется под самую длинную строку, чтобы таблица не выглядела "лесенкой".

## Лаба 4
(возможно, эта лабораторная займет более 1 недели)

### Немного лирики
Допустим, мы создаем движок базы данных, а не конкретную базу данных. Сейчас мы жестко запрограммировали в коде классы для книги, читателя, возможно, какие-то другие вспомогательные классы. Но что если у нас есть схема базы данных, файлы с данными, но это будет не бибилиотека с книгами, а что-то другое?

Ранее до этого мы в коде никаким образом не использовали схему базы данных из отдельного файла. На основе его проектировались классы в программе для считывания файла данных, но сама схема из файла не считывалась и никак не обратывалась. И вот настал ее звездный час. Сначала нужно считать из файла схему БД, создать объекты отвечающие именно за описание структуры БД в коде, а затем на основе этих объект нужно создавать обобщенные объекты таблицы.

Очень грубый пример. Раньше у нас были объекты Student и Book, соответствующие данным из таблиц Students и Books. Сейчас мы не знаем конкретную таблицу, а значит не знаем какие конкретно данные там будут храниться. Значит, нам нужен обощенный объект для таблицы и столбца - эти объекты будут созданы на основе схемы базы данных.

```cs
// тут используется термин "схема", чтобы подчеркнуть, 
// что это не сама таблица. т.е. табличные данные,
// а описание структуры таблицы
public class TableScheme
{
    public string Name { get; }

    // в таблице есть список столбцов
    public List<Column> Columns { get; }

    // конструктор, чтобы заполнить объект при создании
    public Table(...)
    {
        // ...
    }
}

public class Column
{
    public string Name { get; }

    // у колонки есть тип данных в ней
    public ColumnType DataType { get; }
}

public enum ColumnType
{
    Int, Float, String
}
```

А вот сами данные нужно будет хранить отдельно. Опять же очень грубый набросок, который рекомендуется осознать и поправить под собственное видение, которое затем нужно будет аргументировать.

```cs
public class Table
{
    public List<Row> Rows { get; }
    private TableScheme { get; }
}

public class Row
{
    public Dictionary<Column, object> Data { get; }
}
```

Подумайте, почему в классе Row используется Dictionary для хранения данных. Почему ключом является именно Column, а значением object.

### Задание

Спроектируйте систему классов для хранения и работы с любой базой данных, какая бы ни оказалась в файлах. Для примера можете создать несколько других баз данных (json и schema фалйы), например: 
- для хранения результатов футбольных матчей (есть команды из разных городов, какие команды с кем играли, какой счет)
- интернет-магазин (товары с ценой, пользователя с историей заказов, что купили, сколько и когда)

Примеры баз можете придумать сами, не обязательно брать именно эти, но в коде у вас не должно быть классов под конкретную базу, считайте что вы вообще ничего не знаете про конкретную базу. Нужно придумать, каким образом считывать эту информацию из файлов и создавать объекты под них.

## Лаба 5 (2 семестр)
> По идее дальнейшая работа c GUI должна идти во 2 семестре, но если вы пришли сюда раньше, то не стесняйтесь задавать вопросы. Текст лабораторной представлен без подробностей и детального описания действий "для маленьких", поэтому скорее всего у вас возникнет много уточняющих вопросов.

> Препод является backend разработчиком, поэтому не знает тонкостей разработки графических интерфейсов. Поэтому дельных советов или помощи в решении совсем нетипичных проблем почти не будет. Мне придется гуглить точно также как и вам. 

1. Вынесите всю "бизнес-логику" в отдельный проект `DummyDatabase.Core`. В нем ни в коем случае не должно быть работы с консолью.
2. Оставшийся код (например, форматированный вывод на экран консоли) поместите в проект `DummyDatabase.Console`
3. Создайте новый WPF проект `DummyDatabase.Desktop`. У .net появился кросс платформенный тип проектов с gui - [MAUI](https://docs.microsoft.com/en-us/dotnet/maui/get-started/first-app?source=recommendations&tabs=vswin&pivots=devices-android), можете попробовать работать с ним, но препод в нем шарит даже хуже, чем в WPF
4. Сделайте работу с вашей базой данных через графический интерфейс:
    1. при старте программы спросите, какую базу открыть (например, это может быть папка с файлами базы)
    2. после открытия должен отобразиться список доступных таблиц (например, при помощи TreeView)
    3. должна быть возможность посмотреть метаданные таблицы (можно опять же с помощью TreeView сделать выпадающий список со столбцами)
    ![image](https://user-images.githubusercontent.com/2069875/214097914-b91574c2-15fa-4cc1-98cd-901c74479d5b.png)
    3. должна быть возможность открыть для просмотра имеющихся строк в таблице
    

## Лаба 6 (2 семестр)
Добавить возможность редактирования данных при помощи GUI.
1. создание новой БД (задается имя и место хранения файлов БД)
1. создание новой таблицы
    1. перечисляем столбцы и их тип данных
1. редактирование
    1. редактирование БД
    1. редактирование таблицы
        1. переименовать таблицу
        1. переименовать столбец
        1. добавить столбец
        1. удалить столбец
    1. редактирование данных
        1. добавить новую строку
        1. удалить строку
        1. отредактировать строку (любой столбец)

В данной лабе можно игнорировать внешние ключи (если вам это удастся ^_^)

**Подсказка**: удобно будет сделать "режим редактирования данных" в таблице и кнопку "сохранить". И только при нажатии на кнопку вы проверяете, что все данные введены корректно. Или сделать редактирование каждого столбца в таблице отдельно и проверять корректность при переключении на другой столбец. 

Если вы сделаете завязку на "введение символа" и будете каждый раз проверять корректность данных, то это будет работать медленно, плюс потом будет проблема с проверкой внешних ключей (см. следующую лабу).

## Лаба 7 (2 семестр)
В идеале БД должна быть консистентной, т.е. данные в ней должны быть согласованными. Достигается это в том числе за счет слежением за корректностью внешних ключей. Если одна таблица ссылается на данные другой таблицы, то нельзя удалить строку, если ее используют где-то в другой таблице.

Например, студент учится в группе ПрИ-101 (таблица Group, Id = 1). Таблица Student имеет столбец GroupId, в котором записан id группы из таблицы Group. Если в таблице Student есть хотя бы один студент, у которого GroupId=1, то из таблицы Group нельзя удалять строку с группой Id=1, потому что она использзуется. Сначала нужно перевести всех студентов в другую группу и только после этого можно удалить строку из таблицы Group.

В рамках лабы реализуйте работу с внешними ключами. 
1. при создании столбца должен быть флажок "IsForeignKey"
1. если флажок активировали, то появляются выпадающий список со списком уже имеющихся в БД таблиц. После выбора таблицы появляется еще выпадающий список с перечнем столбцов в этой таблицы. Таким образом, вы говорите с каким столбцом вы связываете свой столбец. Например, для в таблице Student столбец GroupId внешний ключ смотрит на таблицу Group, столбец Id
1. при заполнениии данных, если столбец содержит внешний ключ, то должна быть проверка, что заданное значение существует в связанной таблице. Например, вы добавляете нового студента и в столбце GroupId пишете значение 3. Но в таблице Group нет записи с id=3. В этом случае должно появиться сообщение об ошибке и данные в столбце должны очиститься.
1. при просмотре данных сделайте возможность наведения мыши (или выделении столбца), который является внешним ключом, чтобы выводили данные записи, на которую смотрит значение в столбце (например, при наведение в таблице Student на столбец GroupId=3 появляется информация, что Id=3 Name=ПрИ-103)
1. при удалении строки в столбце нужно проверять ссылаются ли другие таблицы на эту таблицу и не зависит ли кто-то на эту конкретную строку в таблице. Если да, то удалить строку нельзя, должна появиться ошибка и строка не должна быть удалена

## Лаба 8 (2 семестр)
Напишите простой язык запросов для своей БД. Добавьте кнопку "создать запрос", при нажатии на которую появляется форма с текстовым полем, куда можно печатать запрос. 

Вы можете реализовать столько операций, сколько захотите, но обязательно нужно реализовать следующие:
* `TABLES` - перечень таблиц, с которыми работает запрос
* `JOIN` - склеить таблицы между собой по какому-то столбцу
* `GET` - список столбцов, которые нужно отобразить в выборке

После ввода запроса в текстовое поле, можно нажать на кнопку "Выполнить". Перед выполнением запроса должна быть проверка на корректность синтаксиса запроса. Если где-то есть ошибка, то нужно вывести сообщение с текстом (уровень подробности и подсвечивать ли место с ошибкой на ваше усмотрение и наличие времени/сил на реализацию).

Если синтаксических ошибок нет, то запрос уходит на выполнение. В результате должна появится новая таблица с выборкой данных. Результат можно только просматривать, редактировать нельзя.

Пример простого запроса:
```
TABLES Students, Groups
JOIN Students -> Groups on Students.GroupId=Groups.Id
GET Students(Id, EntranceDate, Name), Groups(Name)
```

В первой строке `TABLES Students, Groups` мы указали, что будем работать только с двумя таблицами Students и Groups.

Во второй строке `JOIN Students -> Groups on Students.GroupId=Groups.Id` мы склеиваем строки таблиц Students и Groups между собой. Вспомнить как это работает можно [тут](https://gitlab.com/StriderAJR/dummy-database/-/blob/main/what-is-database.md#%D1%8F%D0%B7%D1%8B%D0%BA-%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81%D0%BE%D0%B2). Так мы получим запись с большим кол-вом столбцов как из таблицы Students, так и из таблицы Groups.

Во третьей строке `GET Students(Id, EntranceDate, Name), Groups(Name)` мы перечисляем, какие столбцы из какой таблицы нам нужны в итоговой выборке.

Таким образом у нас получится выдача данных, где для каждого студента выведется его уникальный номер, дата поступления, имя и название группы (не айдишник группу - 1,2,3, а нормальное человекочитаемое имя ПрИ-101 и т.д.).

Более сложный запрос, чтобы вывести оценки студента:
```
TABLES Students, Groups, Subjects, StudentSubjects
JOIN StudentSubjects -> Students on StudentSubjects.StudentId=Students.Id
JOIN StudentSubjects -> Subjects on StudentSubjects.SubjectId=Subjects.Id
JOIN Students -> Groups on Students.GroupId=Groups.Id
GET Groups(Name), Students(Name), Subject(Name), StudentSubjects(Grade)
```